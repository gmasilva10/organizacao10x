[2025-08-24] BUILD — Import inválido de sanitizeAddress
- Sintoma: "Export sanitizeAddress doesn't exist in target module" em web/app/api/students/[id]/route.ts
- Causa: import de ../route (rota não exporta utilitários)
- Fix: mover sanitizeAddress para web/app/api/students/_utils.ts e importar em route.ts e [id]/route.ts
- Confirmação: build verde; DELETE /api/students/:id retornando 200 { ok:true }

[2025-08-24] UX/422 — Criação de aluno
- Causas mapeadas:
  - 422 limit_reached (limits.students)
  - 422 unique_email (e-mail duplicado por tenant)
  - 422 validation (campos inválidos: CEP curto/UF inválida/etc.)
- Tratamento: Toasts específicos no StudentFullModal
  - limit_reached → "Limite de alunos do plano atingido."
  - unique_email → "Este e‑mail já está cadastrado."
  - validation → exibir primeira mensagem legível
- Evidências: web/evidencias/smoke_students_422_body.json
# Registro de Erros e Ocorrências — Personal Global
# Última atualização: 2025-08-20 17:25

[ACC03-ORG-FAIL-2025-08-21] 2025-08-21 — dev — POST /api/account/player — falha ao criar org — S1 — Resolvido — DEV
Passos: preencher formulário em /onboarding/account/player e enviar.
Esperado: 200 com organização criada e cookie pg.active_org definido.
Obtido (anteriormente): 500 PGRST204 (colunas ausentes).
Causa-raiz: divergência de schema (tenants sem doc_id/plan) + inserção sujeita a RLS.
Correção: endpoint usa PostgREST com service-role e payload mínimo (name); idempotência em conflito; cookie httpOnly.
Logs/Evidências: web/Estrutura/account/player_org_created_error_500.json, web/Estrutura/account/player_org_created_fix.json
Confirmação QA: pendente (acionada).

[RED-001] 2025-08-20 — dev — Landing page inacessível — S1 — Resolvido — DEV
Passos: acessar http://localhost:3000 
Esperado: landing page com Header, Hero, Features, Stats, About, Footer
Obtido: redirect automático direto para /app (dashboard)
Diagnóstico: next.config.ts configurado com redirect forçado '/' → '/app'
Fix: removido redirect automático do next.config.ts; fluxo correto restaurado
Confirmação QA: '/' = landing page pública, '/app' = dashboard protegido
Evidências: web/next.config.ts, web/app/page.tsx (landing), web/app/(app)/page.tsx (dashboard)

[ROUTE-001] 2025-08-20 — dev — Dashboard /app exibindo página antiga — S1 — Resolvido — DEV
Passos: acessar http://localhost:3000/app após login
Esperado: dashboard novo com KPIs, filtros, workload, atividade recente
Obtido: página simples "Bem-vindo" com links básicos
Diagnóstico: conflito entre web/app/app/page.tsx (antigo) e web/app/(app)/page.tsx (novo)
Fix: removido web/app/app/page.tsx e pasta web/app/app/ completamente
Confirmação QA: /app agora renderiza o dashboard refinado corretamente
Evidências: web/app/(app)/page.tsx (dashboard V1), estrutura de pastas limpa

[ROUTE-002] 2025-08-20 — dev — 404 em /app após correção ROUTE-001 — S1 — Resolvido — DEV
Passos: fazer login → redirecionado para http://localhost:3000/app
Esperado: dashboard V1 carregando com App Shell completo
Obtido: 404 "This page could not be found"
Diagnóstico: servidor Next.js não reconheceu mudança na estrutura de pastas; cache .next desatualizado
Fix: stop processos Node + Remove-Item .next + npm run dev (restart limpo)
Confirmação QA: LoginDrawer redireciona corretamente para /app (linha 76); rota (app)/page.tsx existe
Evidências: web/components/LoginDrawer.tsx linha 76, estrutura web/app/(app)/page.tsx funcional

[AUTH-001] 2025-08-20 — dev — 404 persiste após login: credenciais Supabase ausentes — S1 — Resolvido — DEV
Passos: tentar fazer login → 404 em /app mesmo com rota correta
Esperado: autenticação bem-sucedida → dashboard carregado
Obtido: 404 contínuo após correções de estrutura de pastas
Diagnóstico: arquivo .env.local não existia; sem credenciais Supabase, cliente falha e layout redireciona
Fix: criado .env.local com NEXT_PUBLIC_SUPABASE_URL + NEXT_PUBLIC_SUPABASE_ANON_KEY + versões server-side + SUPABASE_SERVICE_ROLE_KEY
Confirmação QA: credenciais do projeto kkxlztopdmipldncduvj aplicadas conforme Estrutura/Credenciais_QA_Supabase.txt
Evidências: web/.env.local com 5 variáveis necessárias; servidor reiniciado para aplicar; /api/capabilities deve responder 200 ou 401 (não mais 503)

[ERR-2025-08-20-VAL06] 2025-08-20 — dev — Telemetria Kanban não validável — S2 — Aberto — DEV
Passos: tentar validar eventos via UI (DnD e CRUD de colunas).
Esperado: 204 em /api/kanban/move com evento student.stage.moved; eventos de colunas (create/rename/delete) com columns_version.
Obtido: operações básicas falham (DnD/Histórico/CRUD), logo não há 2xx/204 e nenhum evento válido é emitido.
Logs/Evidências: reunião 20/08; prints e erros anteriores (VAL01..VAL05).
Fix/Workaround: depende de correção dos FAILs de base; não executar contornos por API nesta reunião.
Confirmação QA: —

[STU][S1] 2025-08-25 — dev — Menu Alunos invisível para admin.basic — S1 — Resolvido — DEV
Passos:
- Login como admin.basic@pg.local → não vê/acessa /(app)/students
Esperado:
- Admin deve ver e acessar o menu “Alunos” (RBAC students.read)
Obtido:
- Item oculto por guarda incorreta (dependência de flag inexistente)
Fix/Workaround:
- Hotfix: visibilidade do item “Alunos” passa a seguir RBAC (students.read) e não feature flag
- Rota /(app)/students permanece sob RBAC server-first; limites seguem por toasts/empty-state
Evidências:
- web/evidencias/qa_admin_basic_students_access.png
- web/evidencias/caps_admin_basic.json
Confirmação QA:
- Pendente (executar checklist e anexar prints/JSON)


[2025-08-18 16:50] Categoria: Automação QA (browser)
Título: Intermitência de sessão (401→200) ao automatizar Students
Status: ABERTO
Prioridade: P2
Componente: /app/(app)/students + /api/students
Impacto: Impede captura automática de evidências de editar/excluir/erro em algumas execuções; manual funciona normalmente
Diagnóstico:
- Logs do servidor mostram sequência 401 em GET/POST /api/students e /api/users/trainers logo após entrar em /students e, em seguida, 200 quando a sessão estabiliza
- Em execução manual na UI, a sessão já está válida e os fluxos funcionam (criar/editar/excluir)
Causa provável: corrida entre refresh/escrita de cookies de sessão e chamadas de lista/POST no runner
Evidências: Estrutura/screenshot_students_*.png; trechos do console e log do servidor (linhas 30–52)
Resolução aplicada: Fallback manual aprovado pelo patrocinador/GP; automação movida para backlog
Próximos passos sugeridos:
- Ao retomar automação: aguardar /api/auth/sync 204 → /api/capabilities 200 → reload /students e waitForResponse de GET 200; após ações (POST/PATCH/DELETE) esperar novo GET 200
- Considerar rota de debug /api/debug/session para validar cookies no runner antes de ações
# REGISTRO DE ERROS / INCIDENTES
# Última atualização: 13/08/2025
# Formato: [ID] Data — Ambiente — Título — Gravidade (S1..S4) — Status — Dono
# Inclusão obrigatória de: PASSOS PARA REPRODUZIR, ESPERADO vs OBTIDO, LOGS/EVIDÊNCIAS, FIX/WORKAROUND, CONFIRMAÇÃO DE QA.

[ERR-0001] 2025-08-13 — dev — Logo esticando no Hero em telas grandes — S3 — Concluído — DEV
Passos: abrir / em 1440px++; Observado: distorção sutil na logo; Esperado: proporção intacta.
Evidência: screenshot-ERR-0001.png; Fix: next/image com width/height + sizes; QA: ok 1920/1440/1024.

[ERR-0002] 2025-08-13 — dev — Hover do CTA secundário com contraste limítrofe — S4 — Pendente — DEV
Passos: abrir /, focar CTA secundário “Saiba mais” e aplicar hover no tema claro.
Esperado: contraste AA ≥ 4.5:1.
Obtido: contraste limítrofe em monitores com gamma alto.
Logs/Evidências: Lighthouse dev; observação manual.
Fix/Workaround: ajustar token de hover para aumentar contraste; tratar junto com varredura WCAG.
Confirmação QA: —

Template:
[ERR-XXXX] AAAA-MM-DD — <ambiente> — <título> — S1|S2|S3|S4 — <status> — <dono>
Passos:
Esperado:
Obtido:
Logs/Evidências:
Fix/Workaround:
Confirmação QA:

[ERR-KAN-0004] 2025-08-20 — dev — DnD move retorna 500 e card some após drop — S2 — Aberto — DEV
Passos:
1) Abrir /(app)/onboarding autenticado
2) Arrastar um card de “Novo Aluno” para coluna intermediária
3) Soltar e observar
Esperado:
- Card muda de coluna e permanece visível; em falha, rollback visual + toast
Obtido:
- Card “some” visualmente; console mostra 500 em /api/kanban/move e /api/kanban/reorder; nenhum rollback visual
Logs/Evidências:
- Network: POST /api/kanban/move 500; POST /api/kanban/reorder 500
- Console: mensagens Fast Refresh; erros 500 nas rotas citadas
- Server log: POST /api/kanban/move 500; POST /api/kanban/reorder 500
Fix/Workaround:
- Curto prazo: aplicar rollback otimista no front quando status != 2xx
- Raiz: corrigir persistência no endpoint move (validar envs SUPABASE_URL/KEY, SELECT/PATCH de onboarding_cards, completed_at), e garantir reorder só em sucesso
Confirmação QA:
- Pendente

[ERR-2025-08-20-VAL01] 2025-08-20 — dev — Kanban/Onboarding — DnD card desaparece após soltar — S2 — Aberto — DEV
Passos:
- Mover card de uma coluna para outra.
Esperado:
- Card permanece na nova coluna.
Obtido:
- Card some da UI após soltar.
Logs/Evidências:
- Reunião de alinhamento 20/08, tela compartilhada.
Fix/Workaround:
- Pendente.
Confirmação QA:
- —

[ERR-2025-08-20-VAL05] 2025-08-20 — dev — Onboarding/Kanban — Problemas de Layout/UX (botão duplicado e toggle “Recolher”) — S2 — Aberto — DEV
Passos:
1) Botão "Nova coluna" aparece duplicado (no topo e como "+ Nova coluna" na última coluna).
2) Ação "Recolher/Expandir" não recolhe a sidebar; apenas altera o visual (clareia/escurece), sem persistir o estado esperado.
Esperado:
- Um único ponto de ação para criar coluna (remover "+ Nova coluna" da última coluna ou desabilitar quando já houver botão global).
- Toggle “Recolher” deve colapsar/expandir a navegação lateral com persistência após reload (pg.nav.collapsed), conforme padronização e logs anteriores de validação.
Obtido:
- Duplicidade de CTA para criar coluna.
- Toggle “Recolher” sem efeito funcional de colapso.
Logs/Evidências: prints da reunião (20/08); comportamento contraria Padronizacao.txt (menu recolhível com persistência) e Atividades (UI-001 toggle “Recolher” consistente reportado em 19/08).
Fix/Workaround: pendente.
Confirmação QA: —

[ERR-2025-08-20-VAL04] 2025-08-20 — dev — Onboarding/Kanban — Falhas na Sidebar/Árvore — S2 — Aberto — DEV
Passos:
1. Criar cards → contadores da árvore não atualizam (apenas colunas).
2. Clicar em "Nova Coluna" → todos os cards existentes foram excluídos (comportamento incorreto).
3. Filtro por trainer não aplicável → falta integração do cadastro de alunos com trainers (bloqueio arquitetural).
4. Colapso/expansão da árvore não testável → ausência de treinadores cadastrados.
Esperado:
- Contadores da árvore refletirem cards em tempo real.
- Criar coluna não deve excluir cards existentes.
- Filtro por trainer funcional com base no vínculo aluno/treinador.
- Colapso/expansão persistentes após reload.
Obtido:
- Contadores da árvore não atualizam.
- Criar coluna apaga cards.
- Filtro e colapso não testáveis por falta de integração.
Logs/Evidências: reunião 20/08, prints anexados.
Fix/Workaround: pendente.
Confirmação QA: —

[ERR-2025-08-20-VAL03] 2025-08-20 — dev — Onboarding/Kanban — CRUD de colunas intermediárias com falhas — S2 — Aberto — DEV
Passos:
1. Clicar em "Nova coluna" → erro de validação exibido (“Título obrigatório (mín. 2 caracteres)”).
2. Criar coluna → adicionada, porém não é possível renomear, excluir ou reordenar.
3. Botão de excluir só aparece se houver cards dentro da coluna.
Esperado:
- Criar/renomear/remover colunas intermediárias de forma consistente.
- Excluir visível mesmo sem cards.
- Reordenação persistente.
Obtido:
- Erro de validação incômodo.
- Colunas criadas não podem ser renomeadas/removidas/reordenadas (sem cards).
Logs/Evidências: prints da reunião de alinhamento (20/08), arquivos anexados.
Fix/Workaround: pendente.
Confirmação QA: —

[ERR-2025-08-20-VAL02] 2025-08-20 — dev — Onboarding/History — Runtime TypeError: items.map is not a function — S2 — Aberto — DEV
Passos:
- Acessar /(app)/onboarding/history.
Esperado:
- Carregar últimos 7 dias, exibir tabela, filtros funcionais.
Obtido:
- Erro em runtime “items.map is not a function”; página não renderiza.
Logs/Evidências:
- Reunião de alinhamento 20/08 (stacktrace exibido em tela).
Fix/Workaround:
- Pendente.
Confirmação QA:
- —

