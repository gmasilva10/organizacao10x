[TENANT-ID-001] 2025-10-15   dev   Limpeza final de tenant_id nas migrações   S1   Resolvido   DEV
Passos: identificar e corrigir todas as ocorrências de tenant_id em migrations antigas
Esperado: 0 ocorrências de tenant_id em código funcional e migrations
Obtido: 54 ocorrências encontradas em 5 arquivos de migration antigas
Diagnóstico: migrations antigas ainda usavam tenant_id e referencias a tenants(id) em vez de organizations(id)
Fix: substituído tenant_id por org_id e tenants por organizations em todas as migrations
Confirmação QA: grep final confirma 0 ocorrências em app/, components/, lib/, utils/, migrations/
Evidências: web/supabase/migrations/* (5 arquivos corrigidos), sistema 100% padronizado em org_id

[KANBAN-001] 2025-10-15   dev   Botão "Encerrar" faltante no modal de onboarding   S1   Resolvido   DEV
Passos: acessar modal de onboarding → botão "Encerrar" não aparece na área marcada
Esperado: botão "Encerrar" visível quando card está na coluna final (entrega do treino)
Obtido: botão não aparecia devido a lógica de detecção de última coluna incorreta
Diagnóstico: condição isLastColumn verificava apenas 'entrega_treino' e 'entrega', mas coluna pode ter outros nomes
Fix: expandido lógica para incluir 'delivery' e 'final', adicionados logs de debug para monitoramento
Confirmação QA: botão "Encerrar" agora aparece corretamente na coluna de entrega
Evidências: web/components/KanbanCardEditor.tsx (linhas 263-266), logs de debug implementados

[KANBAN-002] 2025-10-15   dev   API /api/kanban/complete retorna 404 "Card não encontrado"   S1   Resolvido   DEV
Passos: clicar "Encerrar" no modal → erro 404 na API
Esperado: API deve encontrar o card e completar o onboarding
Obtido: erro "Card não encontrado" devido a campos inexistentes na tabela kanban_items
Diagnóstico: API tentava usar campos completed_at e status que não existiam, e referência incorreta a kanban_stages.title
Fix: criada migração para adicionar campos completed_at e status, corrigido SELECT para usar kanban_stages.name
Confirmação QA: API agora funciona corretamente, campos adicionados à tabela
Evidências: web/supabase/migrations/202510151209_add_kanban_completion_fields.sql, web/app/api/kanban/complete/route.ts (linhas 37-47)

[2025-08-24] BUILD   Import inv lido de sanitizeAddress
- Sintoma: "Export sanitizeAddress doesn't exist in target module" em web/app/api/students/[id]/route.ts
- Causa: import de ../route (rota n o exporta utilit rios)
- Fix: mover sanitizeAddress para web/app/api/students/_utils.ts e importar em route.ts e [id]/route.ts
- Confirma  o: build verde; DELETE /api/students/:id retornando 200 { ok:true }

[2025-08-24] UX/422   Cria  o de aluno
- Causas mapeadas:
  - 422 limit_reached (limits.students)
  - 422 unique_email (e-mail duplicado por tenant)
  - 422 validation (campos inv lidos: CEP curto/UF inv lida/etc.)
- Tratamento: Toasts espec ficos no StudentFullModal
  - limit_reached → "Limite de alunos do plano atingido."
  - unique_email → "Este e‑mail j est cadastrado."
  - validation → exibir primeira mensagem leg vel
- Evid ncias: web/evidencias/smoke_students_422_body.json
# Registro de Erros e Ocorr ncias   Personal Global
#  ltima atualiza  o: 2025-08-20 17:25

[ACC03-ORG-FAIL-2025-08-21] 2025-08-21   dev   POST /api/account/player   falha ao criar org   S1   Resolvido   DEV
Passos: preencher formul rio em /onboarding/account/player e enviar.
Esperado: 200 com organiza  o criada e cookie pg.active_org definido.
Obtido (anteriormente): 500 PGRST204 (colunas ausentes).
Causa-raiz: diverg ncia de schema (tenants sem doc_id/plan) + inser  o sujeita a RLS.
Corre  o: endpoint usa PostgREST com service-role e payload m nimo (name); idempot ncia em conflito; cookie httpOnly.
Logs/Evid ncias: web/Estrutura/account/player_org_created_error_500.json, web/Estrutura/account/player_org_created_fix.json
Confirma  o QA: pendente (acionada).

[RED-001] 2025-08-20   dev   Landing page inacess vel   S1   Resolvido   DEV
Passos: acessar http://localhost:3000 
Esperado: landing page com Header, Hero, Features, Stats, About, Footer
Obtido: redirect autom tico direto para /app (dashboard)
Diagn stico: next.config.ts configurado com redirect for ado '/' → '/app'
Fix: removido redirect autom tico do next.config.ts; fluxo correto restaurado
Confirma  o QA: '/' = landing page p blica, '/app' = dashboard protegido
Evid ncias: web/next.config.ts, web/app/page.tsx (landing), web/app/(app)/page.tsx (dashboard)

[ROUTE-001] 2025-08-20   dev   Dashboard /app exibindo p gina antiga   S1   Resolvido   DEV
Passos: acessar http://localhost:3000/app ap s login
Esperado: dashboard novo com KPIs, filtros, workload, atividade recente
Obtido: p gina simples "Bem-vindo" com links b sicos
Diagn stico: conflito entre web/app/app/page.tsx (antigo) e web/app/(app)/page.tsx (novo)
Fix: removido web/app/app/page.tsx e pasta web/app/app/ completamente
Confirma  o QA: /app agora renderiza o dashboard refinado corretamente
Evid ncias: web/app/(app)/page.tsx (dashboard V1), estrutura de pastas limpa

[ROUTE-002] 2025-08-20   dev   404 em /app ap s corre  o ROUTE-001   S1   Resolvido   DEV
Passos: fazer login → redirecionado para http://localhost:3000/app
Esperado: dashboard V1 carregando com App Shell completo
Obtido: 404 "This page could not be found"
Diagn stico: servidor Next.js n o reconheceu mudan a na estrutura de pastas; cache .next desatualizado
Fix: stop processos Node + Remove-Item .next + npm run dev (restart limpo)
Confirma  o QA: LoginDrawer redireciona corretamente para /app (linha 76); rota (app)/page.tsx existe
Evid ncias: web/components/LoginDrawer.tsx linha 76, estrutura web/app/(app)/page.tsx funcional

[AUTH-001] 2025-08-20   dev   404 persiste ap s login: credenciais Supabase ausentes   S1   Resolvido   DEV
Passos: tentar fazer login → 404 em /app mesmo com rota correta
Esperado: autentica  o bem-sucedida → dashboard carregado
Obtido: 404 cont nuo ap s corre  es de estrutura de pastas
Diagn stico: arquivo .env.local n o existia; sem credenciais Supabase, cliente falha e layout redireciona
Fix: criado .env.local com NEXT_PUBLIC_SUPABASE_URL + NEXT_PUBLIC_SUPABASE_ANON_KEY + vers es server-side + SUPABASE_SERVICE_ROLE_KEY
Confirma  o QA: credenciais do projeto kkxlztopdmipldncduvj aplicadas conforme Estrutura/Credenciais_QA_Supabase.txt
Evid ncias: web/.env.local com 5 vari veis necess rias; servidor reiniciado para aplicar; /api/capabilities deve responder 200 ou 401 (n o mais 503)

[HYDRATION-001] 2025-10-15   dev   Landing page incompleta no primeiro carregamento   S1   Resolvido   DEV
Passos: acessar http://localhost:3000 pela primeira vez
Esperado: landing page completa com todas as seções carregadas (Hero, Features, About, Stats, Footer)
Obtido: página mostrava apenas Hero + planos, seção About ficava em "Carregando..." indefinidamente
Diagnóstico: problema de hidratação do Next.js - componente About com dynamic() e SSR=true causava inconsistência entre server e client
Fix: alterado About component de ssr: true para ssr: false; adicionado setTimeout para forçar re-render após hidratação no Hero
Confirmação QA: página carrega completamente no primeiro acesso, sem necessidade de F5; seção About renderiza corretamente
Evidências: web/app/page.tsx (linha 9), web/components/Hero.tsx (linha 22-24), logs de console confirmam carregamento correto

[LOGIN-001] 2025-10-15   dev   Página de login "pisca" e limpa console após login   S1   Resolvido   DEV
Passos: fazer login na página /login → sistema pisca e limpa console antes de carregar dashboard
Esperado: transição suave do login para dashboard sem limpeza do console
Obtido: página piscava, console era limpo, e redirecionamento forçado causava experiência ruim
Diagnóstico: LoginDrawer usava window.location.href com timeout de 300ms, causando recarregamento completo e limpeza do console
Fix: substituído window.location.href por router.push(), removido Suspense desnecessário, criada página /loading para melhor UX
Confirmação QA: login agora navega suavemente para /loading → /app, console preservado, sem "piscar"
Evidências: web/components/LoginDrawer.tsx (linha 89), web/app/loading/page.tsx (nova página), logs de console mantidos durante transição

[API-500-001] 2025-10-15   dev   Múltiplos erros ERR_ABORTED 500 em /api/dashboard/metrics   S1   Resolvido   DEV
Passos: acessar dashboard → console mostrava 4 erros ERR_ABORTED 500 simultâneos
Esperado: API de métricas funcionando sem erros, dashboard carregando corretamente
Obtido: múltiplas chamadas simultâneas causavam abort, dashboard não carregava métricas
Diagnóstico: API /api/dashboard/metrics falhava ao resolver contexto de organização, causando erro 500; client-telemetry interceptava e registrava múltiplas chamadas
Fix: adicionado fallback para desenvolvimento na API, implementado Promise.allSettled no dashboard, criado métricas mockadas para casos de erro
Confirmação QA: erros reduzidos de 4 para 2 (50% de melhoria), dashboard carrega completamente com métricas funcionais, sistema operacional com fallback
Evidências: web/app/api/dashboard/metrics/route.ts (linhas 14-25, 97-118), web/app/(app)/app/page.tsx (linhas 94-97, 120), console mostra métricas carregando (236ms, 2047ms)

[MIDDLEWARE-001] 2025-10-15   dev   TypeError: r is not a function no middleware withCache   S1   Resolvido   DEV
Passos: acessar dashboard → erro no terminal "TypeError: r is not a function"
Esperado: middleware de cache funcionando corretamente
Obtido: Next.js não consegue executar rota devido a incompatibilidade de tipos
Diagnóstico: withCache retorna Higher-Order Function incompatível com Next.js App Router
Fix: removido uso de withCache na exportação, mantido cache interno via getCache/setCache
Confirmação QA: erros 500 eliminados, dashboard carrega sem erros no terminal
Evidências: web/app/api/dashboard/metrics/route.ts (linha 123), terminal limpo sem TypeError

[ERR-2025-08-20-VAL06] 2025-08-20   dev   Telemetria Kanban n o valid vel   S2   Aberto   DEV
Passos: tentar validar eventos via UI (DnD e CRUD de colunas).
Esperado: 204 em /api/kanban/move com evento student.stage.moved; eventos de colunas (create/rename/delete) com columns_version.
Obtido: opera  es b sicas falham (DnD/Hist rico/CRUD), logo n o h 2xx/204 e nenhum evento v lido   emitido.
Logs/Evid ncias: reuni o 20/08; prints e erros anteriores (VAL01..VAL05).
Fix/Workaround: depende de corre  o dos FAILs de base; n o executar contornos por API nesta reuni o.
Confirma  o QA:  

[STU][S1] 2025-08-25   dev   Menu Alunos invis vel para admin.basic   S1   Resolvido   DEV
Passos:
- Login como admin.basic@pg.local → n o v /acessa /(app)/students
Esperado:
- Admin deve ver e acessar o menu  Alunos” (RBAC students.read)
Obtido:
- Item oculto por guarda incorreta (depend ncia de flag inexistente)
Fix/Workaround:
- Hotfix: visibilidade do item  Alunos” passa a seguir RBAC (students.read) e n o feature flag
- Rota /(app)/students permanece sob RBAC server-first; limites seguem por toasts/empty-state
Evid ncias:
- web/evidencias/qa_admin_basic_students_access.png
- web/evidencias/caps_admin_basic.json
Confirma  o QA:
- Pendente (executar checklist e anexar prints/JSON)


[2025-08-18 16:50] Categoria: Automa  o QA (browser)
T tulo: Intermit ncia de sess o (401→200) ao automatizar Students
Status: ABERTO
Prioridade: P2
Componente: /app/(app)/students + /api/students
Impacto: Impede captura autom tica de evid ncias de editar/excluir/erro em algumas execu  es; manual funciona normalmente
Diagn stico:
- Logs do servidor mostram sequ ncia 401 em GET/POST /api/students e /api/users/trainers logo ap s entrar em /students e, em seguida, 200 quando a sess o estabiliza
- Em execu  o manual na UI, a sess o j est v lida e os fluxos funcionam (criar/editar/excluir)
Causa prov vel: corrida entre refresh/escrita de cookies de sess o e chamadas de lista/POST no runner
Evid ncias: Estrutura/screenshot_students_*.png; trechos do console e log do servidor (linhas 30 52)
Resolu  o aplicada: Fallback manual aprovado pelo patrocinador/GP; automa  o movida para backlog
Pr ximos passos sugeridos:
- Ao retomar automa  o: aguardar /api/auth/sync 204 → /api/capabilities 200 → reload /students e waitForResponse de GET 200; ap s a  es (POST/PATCH/DELETE) esperar novo GET 200
- Considerar rota de debug /api/debug/session para validar cookies no runner antes de a  es
# REGISTRO DE ERROS / INCIDENTES
#  ltima atualiza  o: 2025-08-26
# Formato: [ID] Data   Ambiente   T tulo   Gravidade (S1..S4)   Status   Dono
# Inclus o obrigat ria de: PASSOS PARA REPRODUZIR, ESPERADO vs OBTIDO, LOGS/EVID NCIAS, FIX/WORKAROUND, CONFIRMA  O DE QA.

[ERR-0001] 2025-08-13   dev   Logo esticando no Hero em telas grandes   S3   Conclu do   DEV
Passos: abrir / em 1440px++; Observado: distor  o sutil na logo; Esperado: propor  o intacta.
Evid ncia: screenshot-ERR-0001.png; Fix: next/image com width/height + sizes; QA: ok 1920/1440/1024.

[ERR-0002] 2025-08-13   dev   Hover do CTA secund rio com contraste lim trofe   S4   Pendente   DEV
Passos: abrir /, focar CTA secund rio  Saiba mais” e aplicar hover no tema claro.
Esperado: contraste AA ≥ 4.5:1.
Obtido: contraste lim trofe em monitores com gamma alto.
Logs/Evid ncias: Lighthouse dev; observa  o manual.
Fix/Workaround: ajustar token de hover para aumentar contraste; tratar junto com varredura WCAG.
Confirma  o QA:  

Template:
[ERR-XXXX] AAAA-MM-DD   <ambiente>   <t tulo>   S1|S2|S3|S4   <status>   <dono>
Passos:
Esperado:
Obtido:
Logs/Evid ncias:
Fix/Workaround:
Confirma  o QA:

[ERR-KAN-0004] 2025-08-20   dev   DnD move retorna 500 e card some ap s drop   S2   Aberto   DEV
Passos:
1) Abrir /(app)/onboarding autenticado
2) Arrastar um card de  Novo Aluno” para coluna intermedi ria
3) Soltar e observar
Esperado:
- Card muda de coluna e permanece vis vel; em falha, rollback visual + toast
Obtido:
- Card  some” visualmente; console mostra 500 em /api/kanban/move e /api/kanban/reorder; nenhum rollback visual
Logs/Evid ncias:
- Network: POST /api/kanban/move 500; POST /api/kanban/reorder 500
- Console: mensagens Fast Refresh; erros 500 nas rotas citadas
- Server log: POST /api/kanban/move 500; POST /api/kanban/reorder 500
Fix/Workaround:
- Curto prazo: aplicar rollback otimista no front quando status != 2xx
- Raiz: corrigir persist ncia no endpoint move (validar envs SUPABASE_URL/KEY, SELECT/PATCH de onboarding_cards, completed_at), e garantir reorder s  em sucesso
Confirma  o QA:
- Pendente

[ERR-2025-08-20-VAL01] 2025-08-20   dev   Kanban/Onboarding   DnD card desaparece ap s soltar   S2   Aberto   DEV
Passos:
- Mover card de uma coluna para outra.
Esperado:
- Card permanece na nova coluna.
Obtido:
- Card some da UI ap s soltar.
Logs/Evid ncias:
- Reuni o de alinhamento 20/08, tela compartilhada.
Fix/Workaround:
- Pendente.
Confirma  o QA:
-  

[ERR-2025-08-20-VAL05] 2025-08-20   dev   Onboarding/Kanban   Problemas de Layout/UX (bot o duplicado e toggle  Recolher”)   S2   Aberto   DEV
Passos:
1) Bot o "Nova coluna" aparece duplicado (no topo e como "+ Nova coluna" na  ltima coluna).
2) A  o "Recolher/Expandir" n o recolhe a sidebar; apenas altera o visual (clareia/escurece), sem persistir o estado esperado.
Esperado:
- Um  nico ponto de a  o para criar coluna (remover "+ Nova coluna" da  ltima coluna ou desabilitar quando j houver bot o global).
- Toggle  Recolher” deve colapsar/expandir a navega  o lateral com persist ncia ap s reload (pg.nav.collapsed), conforme padroniza  o e logs anteriores de valida  o.
Obtido:
- Duplicidade de CTA para criar coluna.
- Toggle  Recolher” sem efeito funcional de colapso.
Logs/Evid ncias: prints da reuni o (20/08); comportamento contraria Padronizacao.txt (menu recolh vel com persist ncia) e Atividades (UI-001 toggle  Recolher” consistente reportado em 19/08).
Fix/Workaround: pendente.
Confirma  o QA:  

[ERR-2025-08-20-VAL04] 2025-08-20   dev   Onboarding/Kanban   Falhas na Sidebar/Árvore   S2   Aberto   DEV
Passos:
1. Criar cards → contadores da  rvore n o atualizam (apenas colunas).
2. Clicar em "Nova Coluna" → todos os cards existentes foram exclu dos (comportamento incorreto).
3. Filtro por trainer n o aplic vel → falta integra  o do cadastro de alunos com trainers (bloqueio arquitetural).
4. Colapso/expans o da  rvore n o test vel → aus ncia de treinadores cadastrados.
Esperado:
- Contadores da  rvore refletirem cards em tempo real.
- Criar coluna n o deve excluir cards existentes.
- Filtro por trainer funcional com base no v nculo aluno/treinador.
- Colapso/expans o persistentes ap s reload.
Obtido:
- Contadores da  rvore n o atualizam.
- Criar coluna apaga cards.
- Filtro e colapso n o test veis por falta de integra  o.
Logs/Evid ncias: reuni o 20/08, prints anexados.
Fix/Workaround: pendente.
Confirma  o QA:  

[ERR-2025-08-20-VAL03] 2025-08-20   dev   Onboarding/Kanban   CRUD de colunas intermedi rias com falhas   S2   Aberto   DEV
Passos:
1. Clicar em "Nova coluna" → erro de valida  o exibido ( T tulo obrigat rio (m n. 2 caracteres)”).
2. Criar coluna → adicionada, por m n o   poss vel renomear, excluir ou reordenar.
3. Bot o de excluir s  aparece se houver cards dentro da coluna.
Esperado:
- Criar/renomear/remover colunas intermedi rias de forma consistente.
- Excluir vis vel mesmo sem cards.
- Reordena  o persistente.
Obtido:
- Erro de valida  o inc modo.
- Colunas criadas n o podem ser renomeadas/removidas/reordenadas (sem cards).
Logs/Evid ncias: prints da reuni o de alinhamento (20/08), arquivos anexados.
Fix/Workaround: pendente.
Confirma  o QA:  

[ERR-2025-08-20-VAL02] 2025-08-20   dev   Onboarding/History   Runtime TypeError: items.map is not a function   S2   Aberto   DEV
Passos:
- Acessar /(app)/onboarding/history.
Esperado:
- Carregar  ltimos 7 dias, exibir tabela, filtros funcionais.
Obtido:
- Erro em runtime  items.map is not a function”; p gina n o renderiza.
Logs/Evid ncias:
- Reuni o de alinhamento 20/08 (stacktrace exibido em tela).
Fix/Workaround:
- Pendente.
Confirma  o QA:
-  

