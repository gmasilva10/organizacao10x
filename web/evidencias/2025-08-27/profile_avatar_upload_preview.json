{
  "test_case": "Profile Avatar Upload & Preview - P0 Module",
  "timestamp": "2025-08-27T10:00:00Z",
  "module": "feat/profile-avatar-and-ux",
  "avatar_upload_flow": {
    "step_1": {
      "action": "navigate_to_profile",
      "route": "/app/profile",
      "current_avatar": null,
      "ui_elements": {
        "avatar_placeholder": "User icon visible",
        "upload_button": "Alterar avatar",
        "description": "JPEG, PNG ou WebP. Máximo 5MB."
      }
    },
    "step_2": {
      "action": "select_avatar_file",
      "file": {
        "name": "avatar.jpg",
        "size": 2048000,
        "type": "image/jpeg"
      },
      "frontend_validation": {
        "size_check": "pass",
        "type_check": "pass"
      },
      "preview": {
        "shows_immediately": true,
        "replaces_placeholder": true
      }
    },
    "step_3": {
      "action": "upload_to_server",
      "api_call": {
        "endpoint": "POST /api/profile/avatar",
        "method": "POST",
        "body": "FormData with avatar file",
        "response": {
          "status": 200,
          "body": {
            "ok": true,
            "avatar_url": "https://supabase.storage/avatars/user-123-1234567890.jpg",
            "profile": {
              "user_id": "user-123",
              "avatar_url": "https://supabase.storage/avatars/user-123-1234567890.jpg"
            }
          }
        }
      },
      "ui_feedback": {
        "loading_spinner": true,
        "button_disabled": true,
        "button_text": "Enviando..."
      }
    },
    "step_4": {
      "action": "success_response",
      "ui_updates": {
        "preview_cleared": true,
        "avatar_updated": true,
        "toast": {
          "type": "success",
          "message": "Avatar atualizado com sucesso!"
        }
      },
      "profile_context_updated": true
    }
  },
  "dropdown_menu_integration": {
    "location": "AppShell header (canto superior direito)",
    "trigger": {
      "displays_avatar": true,
      "fallback_icon": "User icon",
      "user_info": "Nome + papel",
      "chevron_down": true
    },
    "dropdown_items": [
      {
        "icon": "User",
        "text": "Meu Perfil",
        "href": "/app/profile"
      },
      {
        "icon": "Settings", 
        "text": "Configurações",
        "href": "/app/settings",
        "visible_for": ["admin", "manager"]
      },
      {
        "icon": "LogOut",
        "text": "Sair",
        "action": "logout",
        "style": "text-red-600"
      }
    ]
  },
  "file_validation": {
    "frontend": {
      "max_size": "5MB",
      "allowed_types": ["image/jpeg", "image/png", "image/webp"],
      "error_messages": {
        "file_too_large": "Arquivo muito grande. Máximo 5MB.",
        "invalid_type": "Tipo de arquivo inválido. Use JPEG, PNG ou WebP."
      }
    },
    "backend": {
      "max_size": "5MB",
      "allowed_types": ["image/jpeg", "image/png", "image/webp"],
      "storage": "Supabase Storage bucket 'avatars'",
      "error_codes": ["file_too_large", "invalid_file_type", "upload_failed"]
    }
  },
  "security": {
    "filename_generation": "user_id + timestamp + extension",
    "storage_path": "avatars/{user_id}-{timestamp}.{ext}",
    "public_url": true,
    "cache_control": "3600 seconds"
  },
  "audit_telemetry": {
    "event_type": "profile.avatar_updated",
    "payload": {
      "file_size": "number",
      "file_type": "string",
      "ts": "ISO timestamp"
    },
    "non_blocking": true
  }
}
