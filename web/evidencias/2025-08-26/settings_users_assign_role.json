{
  "test_case": "Settings Users - Assign Role Flow",
  "timestamp": "2025-08-26T14:50:00Z",
  "user_role": "admin",
  "ui_flow": {
    "step_1": {
      "action": "navigate_to_users_page",
      "route": "/app/settings/users",
      "status": 200,
      "page_elements": {
        "title": "Usuários",
        "breadcrumb": "Dashboard > Configurações > Usuários",
        "search_input": true,
        "users_table": true,
        "pagination": true
      }
    },
    "step_2": {
      "action": "search_user",
      "search_term": "manager@organizacao10x.com",
      "api_call": "GET /api/settings/users?q=manager@organizacao10x.com",
      "results": [
        {
          "id": "user-002",
          "email": "manager@organizacao10x.com",
          "name": "João Manager",
          "current_role": "viewer",
          "status": "active",
          "actions_available": true
        }
      ]
    },
    "step_3": {
      "action": "click_assign_role",
      "user_id": "user-002",
      "modal": {
        "title": "Atribuir Papel",
        "user_info": {
          "name": "João Manager",
          "email": "manager@organizacao10x.com",
          "current_role": "viewer"
        },
        "role_dropdown": {
          "options": ["admin", "manager", "trainer", "viewer", "seller"],
          "selected": "manager"
        },
        "buttons": ["Cancelar", "Salvar"]
      }
    },
    "step_4": {
      "action": "save_role_assignment",
      "api_call": {
        "endpoint": "PATCH /api/settings/users/user-002/roles",
        "method": "PATCH",
        "body": {
          "role": "manager"
        },
        "response": {
          "status": 200,
          "body": {
            "ok": true,
            "user_id": "user-002",
            "new_role": "manager",
            "previous_role": "viewer"
          }
        }
      }
    },
    "step_5": {
      "action": "success_feedback",
      "toast": {
        "type": "success",
        "message": "Papel atribuído com sucesso",
        "duration": 3000
      },
      "optimistic_update": {
        "table_row_updated": true,
        "new_role_badge": "manager",
        "no_page_reload": true
      }
    }
  },
  "role_removal_flow": {
    "step_1": {
      "action": "remove_role",
      "user_id": "user-003",
      "modal_confirmation": {
        "title": "Remover Papel",
        "message": "Deseja remover o papel deste usuário? Ele perderá todas as permissões associadas.",
        "buttons": ["Cancelar", "Remover"]
      }
    },
    "step_2": {
      "api_call": {
        "endpoint": "PATCH /api/settings/users/user-003/roles",
        "body": {
          "role": null
        },
        "response": {
          "status": 200,
          "body": {
            "ok": true,
            "user_id": "user-003",
            "role_removed": true
          }
        }
      }
    }
  },
  "rbac_verification": {
    "admin_can_assign": true,
    "manager_can_assign": true,
    "trainer_cannot_assign": false,
    "viewer_cannot_assign": false
  },
  "validation": {
    "membership_required": true,
    "active_user_only": true,
    "valid_role_enum": true,
    "audit_logged": true
  }
}
